<div class="chat-popup" [style.right.px]="20 + index * 340">
  <div class="chat-header">
    <span>Chat</span>
    <button (click)="close.emit()">×</button>
  </div>

  <div class="chat-messages">
    <ng-container *ngFor="let msg of messages">
      
      <!-- ✅ Message système centré -->
      <div *ngIf="msg.system" class="system-message">
        {{ msg.content }}
      </div>
  
      <!-- ✅ Message utilisateur -->
      <div *ngIf="!msg.system"
           class="message-wrapper"
           [ngClass]="{
             'sent': +msg.sender === currentUserId,
             'received': +msg.sender !== currentUserId
           }">
  
        <img
  *ngIf="+msg.sender !== currentUserId"
  class="sender-image clickable"
  [src]="msg.senderImage || defaultProfileImage"
  alt="Helper"
  (click)="goToHelperProfile(msg.sender)" />

<img
  *ngIf="+msg.sender === currentUserId"
  class="sender-image"
  [src]="msg.senderImage || defaultProfileImage"
  alt="You" />
  
        <div class="message">
          {{ msg.content }}
        </div>
      </div>
    </ng-container>
  </div>
  
  <!-- Bouton Confirm pour le client uniquement -->
  <div *ngIf="isClient && orderStatus !== 'Booked'" class="confirm-section">
    <button class="confirm-btn" (click)="confirmOrder()">Confirm</button>
  </div>
  

  <div class="input-bar">
    <input
      [(ngModel)]="messageText"
      placeholder="Type a message..."
      (keyup.enter)="send()" />
    <button (click)="send()">Send</button>
  </div>
</div>
